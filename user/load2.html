

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Load Data - Scalable Harvest &mdash; PDS Registry 1.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Detailed Harvest Configuration" href="harvest_job_configuration.html" />
    <link rel="prev" title="Load Data - Standalone Harvest" href="load1.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> PDS Registry
          

          
            
            <img src="../_static/PDS_Planets.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About PDS Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cloud_startup.html">Cloud Startup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tasks.html">User Tasks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="load1.html">Load Data - Standalone Harvest</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Load Data - Scalable Harvest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scalable-harvest-quick-start">Scalable Harvest Quick Start</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration-file">Configuration File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#submit-a-job">Submit a Job</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="harvest_job_configuration.html">Detailed Harvest Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="update_status.html">Update Archive Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="delete_data.html">Delete Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="dashboards.html">Dashboards</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../admin/tasks.html">Admin Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/support.html">Support</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PDS Registry</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="tasks.html">User Tasks</a> &raquo;</li>
        
      <li>Load Data - Scalable Harvest</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/pds-data-dictionaries/ldd-template/blob/main/docs/source/user/load2.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="load-data-scalable-harvest">
<h1>Load Data - Scalable Harvest<a class="headerlink" href="#load-data-scalable-harvest" title="Permalink to this headline">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>To load PDS4 data into Registry you have to use Harvest software. There are two versions of Harvest:
a simple standalone command-line tool and a scalable Harvest consisting of several server and and
client components. Scalable Harvest can process big data sets in parallel.
Both versions extract metadata from PDS4 products (labels) and load extracted
metadata into OpenSearch database.</p>
<p>This document describes how to use Harvest Client command-line tool to submit jobs to Scalable Harvest Server cluster.</p>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>OpenSearch server is <a class="reference external" href="https://opensearch.org/">running</a>.</p></li>
<li><p>Registry indices are <a class="reference external" href="../admin/create_reg.html#create-registry">created</a> in OpenSearch.</p></li>
<li><p>All server components - RabbitMQ, Crawler Server, Harvest Server - are deployed and running on-prem or in the cloud.</p></li>
<li><p>Harvest Client command-line tool is installed.</p></li>
</ul>
</section>
<section id="scalable-harvest-quick-start">
<h2>Scalable Harvest Quick Start<a class="headerlink" href="#scalable-harvest-quick-start" title="Permalink to this headline">¶</a></h2>
<p>Scalable Harvest consists of several server components: RabbitMQ, Crawler and Harvest servers.
To load data you have to use Harvest Client command-line tool to submit a job to Harvest server cluster.</p>
<section id="configuration-file">
<h3>Configuration File<a class="headerlink" href="#configuration-file" title="Permalink to this headline">¶</a></h3>
<p>Harvest Client requires message broker (RabbitMQ) connection to submit jobs to the Harvest server cluster.
Default configuration file, <em>&lt;INSTALL_DIR&gt;/conf/harvest-client.cfg</em>, has the following parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Message server type. Currently, only &#39;RabbitMQ&#39; is supported.</span>
<span class="n">mq</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">RabbitMQ</span>

<span class="c1"># RabbitMQ host(s). One or more host:port tuples (one tuple per line).</span>
<span class="c1"># rmq.host = host1:5672</span>
<span class="c1"># rmq.host = host2:5672</span>
<span class="c1"># rmq.host = host3:5672</span>

<span class="n">rmq</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5672</span>

<span class="c1"># RabbitMQ user</span>
<span class="n">rmq</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">harvest</span>

<span class="c1"># RabbitMQ password</span>
<span class="n">rmq</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">harvest</span>
</pre></div>
</div>
<p>You can either edit default configuration file, or create another file and pass it to Harvest Client CLI as a parameter.</p>
</section>
<section id="submit-a-job">
<h3>Submit a Job<a class="headerlink" href="#submit-a-job" title="Permalink to this headline">¶</a></h3>
<p>To submit a job to the harvest server cluster you need a job configuration file.
An example configuration file is available in the installation directory:
<em>&lt;INSTALL_DIR&gt;/examples/directories.xml</em>.</p>
<p>You will need to update the nodeName:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;harvest</span><span class="w"> </span><span class="na">nodeName=</span><span class="s">&quot;PDS_GEO&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
<p>The path to the data.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;directories&gt;</span>
<span class="w">  </span><span class="nt">&lt;path&gt;</span>/data/geo/urn-nasa-pds-kaguya_grs_spectra<span class="nt">&lt;/path&gt;</span>
<span class="nt">&lt;/directories&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Crawler and Harvest servers should be able to read this path.</p>
</aside>
<p>And the URL prefix for the data:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;fileInfo&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- UPDATE with your own local path and base url where pds4 archive is published --&gt;</span>
<span class="w">  </span><span class="nt">&lt;fileRef</span><span class="w"> </span><span class="na">replacePrefix=</span><span class="s">&quot;/data/geo/&quot;</span><span class="w"> </span><span class="na">with=</span><span class="s">&quot;https://pds-geosciences.wustl.edu/lunar/&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/fileInfo&gt;</span>
</pre></div>
</div>
<p>If you save this file as <em>/tmp/job1.xml</em> and run Harvest Client:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">INSTALL_DIR</span><span class="o">&gt;/</span><span class="nb">bin</span><span class="o">/</span><span class="n">harvest</span><span class="o">-</span><span class="n">client</span> <span class="n">harvest</span> <span class="o">-</span><span class="n">j</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">job1</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
<p>You should see output similar to this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Reading</span> <span class="n">job</span> <span class="kn">from</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">job1</span><span class="o">.</span><span class="n">xml</span>
<span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Reading</span> <span class="n">configuration</span> <span class="kn">from</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">big</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">harvest</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="mf">1.0.0</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">harvest</span><span class="o">-</span><span class="n">client</span><span class="o">.</span><span class="n">cfg</span>
<span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Creating</span> <span class="n">new</span> <span class="n">job</span><span class="o">...</span>
<span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Connecting</span> <span class="n">to</span> <span class="n">RabbitMQ</span>
<span class="p">[</span><span class="n">INFO</span><span class="p">]</span> <span class="n">Created</span> <span class="n">job</span> <span class="n">f282a012</span><span class="o">-</span><span class="mf">115e-429</span><span class="n">c</span><span class="o">-</span><span class="n">b445</span><span class="o">-</span><span class="n">f5eed1d81303</span>
</pre></div>
</div>
<p>After submitting a job, you can monitor progress by querying OpenSearch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="s2">&quot;http://localhost:9200/registry/_search?q=_package_id:f282a012-115e-429c-b445-f5eed1d81303&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For backward compatibility, job ID field is called “_package_id” in OpenSearch.</p>
</aside>
<p>This <a class="reference external" href="./harvest_job_configuration.html">page</a> describes the job configuration file in detail.</p>
</section>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>When ready for public release, you need to <a class="reference external" href="update_status.html">update the archive status</a></p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="harvest_job_configuration.html" class="btn btn-neutral float-right" title="Detailed Harvest Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="load1.html" class="btn btn-neutral float-left" title="Load Data - Standalone Harvest" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2022 California Institute of Technology

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>